[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:postgresql]
priority=10
command=/usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresql/data
user=postgres
autorestart=true
stdout_logfile=/var/log/postgresql.log
stderr_logfile=/var/log/postgresql.err

[program:redis]
priority=20
command=redis-server --daemonize no --bind 0.0.0.0
user=redis
autorestart=true
stdout_logfile=/var/log/redis.log
stderr_logfile=/var/log/redis.err

[program:api]
directory=/app
command=node apps/api/dist/main
user=root
autorestart=true
startretries=5
startsecs=5
environment=NODE_ENV=production,DATABASE_URL="postgresql://jasca:jasca_secret@127.0.0.1:5432/jasca?sslmode=disable",REDIS_URL="redis://127.0.0.1:6379",JWT_SECRET="jasca_offline_secret",CORS_ORIGIN="https://jasca.koreacb.com"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:web]
directory=/app
command=node apps/web/server.js
user=root
autorestart=true
startretries=5
startsecs=10
; API_URL은 컨테이너 내부 통신용 (127.0.0.1), 외부 접속은 nginx/reverse proxy에서 처리
environment=NODE_ENV=production,PORT=3000,HOSTNAME="0.0.0.0",API_URL="http://127.0.0.1:3001"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0


